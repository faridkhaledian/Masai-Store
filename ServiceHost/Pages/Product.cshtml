@page "{id}"
@model ServiceHost.Pages.ProductModel
@{
    Layout = "Shared/_Layout";
    ViewData["Title"] = Model.Product.Name;
    var imgIndex = 1;

}
<main class="single-product default">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav>
                    <ul class="breadcrumb">
                        <li>
                            <a asp-page="/Index"><i class="fa fa-home" aria-hidden="true"></i></a>

                        </li>
                        <li>
                            <a asp-page="/ProductCategory" asp-route-id="@Model.Product.CategorySlug"><span>@Model.Product.Category</span></a>
                        </li>
                        <li>
                            <a asp-page="/Product" asp-route-id="@Model.Product.Slug"><span>@Model.Product.Name</span></a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <article class="product">
                    <div class="row product_main_details">
                        <div class="col-lg-5 col-md-6 col-sm-12">
                            <div class="product-gallery default">
                                <img class="main_img_gallery" src="~/FileUploade/@Model.Product.Picture" alt="@Model.Product.PictureAlt" title="@Model.Product.PictureTitle" />

                                <section class="testimonial py-3" id="testimonial">
                                    <div class="container">
                                        <div class="row gallery">
                                            @foreach (var picture in Model.Product.Pictures)
                                            {
                                                <div class="col-4 col-md-3 pd">
                                                    <a href="~/FileUploade/@picture.Picture" rel="prettyPhoto[gallery1]">
                                                        <img src="~/FileUploade/@picture.Picture" class="img-thumb" alt="@picture.PictureAlt" title="@picture.PictureTitle" />
                                                    </a>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <ul class="gallery-options">
                                <li>
                                    <button class="add-favorites favorites2"><i class="fa fa-heart"></i></button>
                                </li>
                                <li>
                                    <button class="favorites2" data-toggle="modal" data-target="#myModal"><i class="fa fa-share-alt"></i></button>
                                </li>
                            </ul>
                            <!-- Modal Core -->
                            <div class="modal-share modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">به اشتراک گذاشتن</h4>
                                        </div>

                                        <div class="modal-footer">
                                            <form class="default">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <p>
                                                            برای کپی آدرس در کادر زیر دابل کلیک کنید
                                                        </p>
                                                        <p class="right-side-header shareurlvalue" title="کپی بعد دوبار کلیک" id="text" onclick="copyElementText(this.id)">http://www.mysite.com/single-product.html</p>

                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Modal Core -->
                        </div>
                        <div class="col-lg-7 col-md-6 col-sm-12 ">


                            <h2 class="product-title ">
                                <a asp-page="/Product" asp-route-id="@Model.Product.Slug"> @Model.Product.Name </a>
                            </h2>
                            <hr class="hr-text" data-content="دو سیم‌ کارت ظرفیت 1 ترابایت و 6 گیگابایت رم ">
                            <div class="row">
                                <div class="col-6">
                                    <ul class="list-group space-15">
                                        <li class="list-group-item">کد : @Model.Product.Code</li>
                                        <li class="list-group-item">بلوتوث:دارد</li>
                                        <li class="list-group-item"> رزولوشن عکس : 12 مگاپیکسل</li>
                                        <li class="list-group-item"> اندازه  : 6.1</li>
                                    </ul>
                                </div>
                                <div class="col-6">
                                    <ul class="list-group space-15">
                                        <li class="list-group-item">قابلیت : ضد آب</li>
                                        <li class="list-group-item"> نوع گوشی : دو گوشی</li>
                                        <li class="list-group-item"> سیستم عامل : iOS 15</li>
                                        <li class="list-group-item"> فناوری  : Super Retina XDR OLED</li>

                                    </ul>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12 product_main_pr">

                                    <div class="time_pr">


                                        <div class="row">
                                            <div class="col-12 upda border_left">

                                                <b>
                                                    <i class="fa fa-calendar" aria-hidden="true"></i>

                                                    زمان ارسال محصول :
                                                </b>
                                                از انبار مَسای کالا طی 2 روز کاری

                                                </br>
                                                <b>
                                                    <i class="fa fa-archive"></i> در انبار :
                                                </b>
                                                @if (Model.Product.IsInStock)
                                                {
                                                    <span class="text-success">موجودی دارد </span>
                                                }
                                                else
                                                {
                                                    <span class="text-danger">موجودی ندارد </span>
                                                }

                                            </div>
                                            @if (Model.Product.IsInStock)
                                            {

                                                <div class="col-12 col-lg-6 col-md-6">
                                                    @if (Model.Product.HasDiscount)
                                                    {
                                                        <p>زمان باقی مانده </p>
                                                        <div class="countdown-timer" countdown="" data-date="@Model.Product.DiscountExpireDate">
                                                            <ul class="text_countdown">
                                                                <li data-days="" class="number_countdown"></li>
                                                                <li>روز</li>
                                                            </ul>
                                                            <ul class="text_countdown">
                                                                <li data-hours="" class="number_countdown"></li>
                                                                <li>ساعت</li>
                                                            </ul>
                                                            <ul class="text_countdown">
                                                                <li data-minutes="" class="number_countdown"></li>
                                                                <li>دقیقه</li>
                                                            </ul>
                                                            <ul class="text_countdown">
                                                                <li data-seconds="" class="number_countdown"></li>
                                                                <li>ثانیه</li>
                                                            </ul>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <p>@Model.Product.ShortDescription</p>
                                                    }
                                                </div>

                                                <div class="col-12 col-lg-6 col-md-6 border_left">

                                                    <div class="price space-15">
                                                        @if (Model.Product.HasDiscount)
                                                        {
                                                            <del><span>@Model.Product.Price<span>تومان</span></span></del>
                                                            <ins><span>@Model.Product.PriceWithDiscount<span>تومان</span></span></ins>
                                                        }
                                                        else
                                                        {
                                                            <ins><span>@Model.Product.Price<span>تومان</span></span></ins>
                                                        }
                                                    </div>

                                                    <div class="col-12 timer-title text--center">

                                                        <a href="#" class="btn btn-main-masai big_btn">افزودن به سبد</a>
                                                    </div>
                                                </div>

                                            }
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <p class="txt_note">
                                        <i class="fa fa-tags" aria-hidden="true"></i>
                                        <b>
                                            تگ‌ها :
                                        </b>
                                        @Model.Product.Keywords
                                    </p>
                                    <p class="txt_note">
                                        <i class="fa fa-info" aria-hidden="true"></i>
                                        برای کالاهای گروه موبایل، امکان برگشت کالا به دلیل انصراف از خرید تنها در صورتی مورد قبول است که کالا بدون هیچگونه استفاده و با تمامی قطعات، متعلقات و بسته‌بندی‌های اولیه خود بازگردانده شود. لازم به ذکر است که برای هر کالای موبایل، ضمانت رجیستری صادر می‌شود. در صورت بروز اشکال در ضمانت رجیستری، پس از انقضای مدت ۳۰ روزه، کالا می‌تواند بازگردانده شود.
                                    </p>
                                </div>

                            </div>


                        </div>

                    </div>
                </article>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-12 default no-padding bg_single_product">
                    <div class="product-tabs default">
                        <div class="box-tabs default">
                            <ul class="nav" role="tablist">
                                <li class="box-tabs-tab">
                                    <a class="active " data-toggle="tab" href="#desc" role="tab" aria-expanded="true">
                                        توضیحات تکمیلی
                                    </a>
                                </li>
                                <li class="box-tabs-tab">
                                    <a data-toggle="tab" href="#params" role="tab" aria-expanded="false">
                                        مشخصات محصول
                                    </a>
                                </li>
                                <li class="box-tabs-tab">
                                    <a data-toggle="tab" href="#comments" role="tab" aria-expanded="false">
                                        دیدگاه خریداران
                                    </a>
                                </li>
                                <li class="box-tabs-tab">
                                    <a data-toggle="tab" href="#comments_questions" role="tab" aria-expanded="false">
                                        پرسش و نظر
                                    </a>
                                </li>
                            </ul>
                            <div class="card-body default">
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div class="tab-pane active" id="desc" role="tabpanel" aria-expanded="true">

                                        <header class="card-header">
                                            <h3 class="card-title"><span>بررسی تخصصی : @Model.Product.Name</span></h3>
                                        </header>
                                        <div class="parent-expert default">
                                            <div class="content-expert">
                                                <p>
                                                    @Model.Product.Description
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane params" id="params" role="tabpanel" aria-expanded="false">
                                        <header class="card-header">
                                            <h3 class="card-title"><span>بررسی تخصصی : @Model.Product.Name</span></h3>
                                        </header>
                                        <div class="col-12">
                                            <ul class="list-group ">
                                                <li class="list-group-item">کد : @Model.Product.Code</li>
                                                <li class="list-group-item">بلوتوث:دارد</li>
                                                <li class="list-group-item"> رزولوشن عکس : 12 مگاپیکسل</li>
                                                <li class="list-group-item"> اندازه  : 6.1</li>
                                                <li class="list-group-item">قابلیت : ضد آب</li>
                                                <li class="list-group-item"> نوع گوشی : دو گوشی</li>
                                                <li class="list-group-item"> سیستم عامل : iOS 15</li>
                                                <li class="list-group-item"> فناوری  : Super Retina XDR OLED</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="comments" role="tabpanel" aria-expanded="false">

                                        <header class="card-header">
                                            <h3 class="card-title"><span>دیدگاه های دیگر کاربران (@Model.Product.Comments.Count) </span></h3>
                                        </header>
                                        <div class="comments_form default">
                                            <ol class="comment-list">
                                                <ul id="commentList">

                                                    @foreach (var comment in Model.Product.Comments)
                                                    {
                                                        <li id="comment-@comment.Id">
                                                            <div class="comment-body">
                                                                <div class="comment-author">
                                                                    <img alt="@Model.Product.PictureAlt"
                                                                         title="@Model.Product.PictureTitle"
                                                                         src="@Url.Content("~/Theme/assets/img/profile/" + imgIndex + ".png")"
                                                                         class="avatar" />
                                                                    <div class="text-h5">
                                                                        <span class="reply-btn">
                                                                            <a href="javascript:void(0);" onclick="setReply(@comment.Id)">
                                                                                <i class="fas fa-reply"></i> پاسخ
                                                                            </a>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <p>@comment.Message</p>
                                                                <ul class="commentul">
                                                                    <li>@comment.CreationDate</li>
                                                                    <li>@comment.Name</li>
                                                                    @if (comment.ParentId > 0)
                                                                    {
                                                                        <li>
                                                                            <span>در پاسخ به: </span><a href="#comment-@comment.ParentId">@comment.parentName</a>
                                                                        </li>
                                                                    }
                                                                </ul>
                                                            </div>
                                                        </li>
                                                       imgIndex++;
                                                        if (imgIndex > 4) { imgIndex = 1; }
                                                    }
                                                </ul>
                                            </ol>
                                        </div>
                                    </div>
                                    <div class="tab-pane form-comment" id="comments_questions" role="tabpanel" aria-expanded="false">
                                        <header class="card-header">
                                            <h3 class="card-title"><span>ارسال نظر و پرسش  </span></h3>
                                        </header>
                                        <div class="comments_form" id="postComment">
                                            <form method="post">
                                                <div class="rating-form row">
                                                    <div class="col-md-4 col-12 form-group">
                                                        <label for="name">نام:</label>
                                                        <textarea id="name" class="form-control" name="name" type="text" placeholder="مثال: علی علوی" rows="1"></textarea>
                                                    </div>
                                                    <div class="col-md-4 col-12 form-group">
                                                        <label for="email">ایمیل:</label>
                                                        <textarea class="form-control" id="email" placeholder="مثال: contact@atriya.com" name="email" type="text" rows="1"></textarea>
                                                    </div>
                                                    <div class="col-md-4 col-12 form-group">
                                                        <label for="Website">وبسایت:</label>
                                                        <textarea class="form-control" id="Website" placeholder="مثال: Masai2025.ir" name="Website" type="text" rows="1"></textarea>
                                                    </div>
                                                    <input type="hidden" name="ownerRecordId" value="@Model.Product.Id" />
                                                    <input type="hidden" name="parentId" id="commentParentId" value="" />
                                                    <input type="hidden" name="productSlug" value="@Model.Product.Slug" />
                                                </div>
                                                <textarea class="form-control" name="message" id="message" placeholder="متن نظر و پرسش" rows="3"></textarea>
                                                <button class="btn btn-main-masai" type="submit">ارسال برای تایید</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Product {

    <script>
                function setReply(commentId) {
            // مقداردهی parentId
            $("#commentParentId").val(commentId);

            // فعال کردن تب "پرسش و نظر"
            var tabTrigger = document.querySelector('a[href="#comments_questions"]');
            if (tabTrigger) {
                $(tabTrigger).tab("show"); }

            // کمی صبر کن تا تب باز بشه بعد اسکرول کن
            setTimeout(() => {
                document.getElementById("postComment").scrollIntoView({
                    behavior: "smooth",
                    block: "start"
                });
            }, 300);
        }
    </script>
}